<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/admin_layout}">
<head>

</head>
<body>
<!-- content 프래그먼트 -->
<section layout:fragment="content" th:fragment="content">
    <link rel="stylesheet" th:href="@{/admin/css/orders-list.css}"/>
    <div class="admin-container" style="margin-top: var(--header-height);">
        <div class="page-header">
            <h2>주문 관리</h2>
            <div>
                <button id="exportOrdersBtn" class="btn btn-outline">
                    <i class="fas fa-file-export"></i> 엑셀 내보내기
                </button>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h3>주문 검색</h3>
            </div>
            <div class="panel-body">
                <form id="searchForm" th:action="@{/admin/orders}" method="get">
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="orderDateStart">주문 기간</label>
                                <div class="date-range-picker">
                                    <input type="date" class="form-input" id="orderDateStart" name="orderDateStart"
                                           th:value="${#dates.format(param.orderDateStart, 'yyyy-MM-dd')}"
                                           placeholder="시작일">
                                    <span class="date-separator">~</span>
                                    <input type="date" class="form-input" id="orderDateEnd" name="orderDateEnd"
                                           th:value="${#dates.format(param.orderDateEnd, 'yyyy-MM-dd')}"
                                           placeholder="종료일">
                                </div>
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="orderStatus">주문 상태</label>
                                <select class="form-select" id="orderStatus" name="orderStatus">
                                    <option value="">전체</option>
                                    <option value="PAYMENT_PENDING" th:selected="${param.orderStatus == 'PAYMENT_PENDING'}">결제 대기</option>
                                    <option value="PAYMENT_COMPLETE" th:selected="${param.orderStatus == 'PAYMENT_COMPLETE'}">결제 완료</option>
                                    <option value="PREPARING" th:selected="${param.orderStatus == 'PREPARING'}">상품 준비중</option>
                                    <option value="SHIPPING" th:selected="${param.orderStatus == 'SHIPPING'}">배송중</option>
                                    <option value="DELIVERED" th:selected="${param.orderStatus == 'DELIVERED'}">배송 완료</option>
                                    <option value="CANCELED" th:selected="${param.orderStatus == 'CANCELED'}">주문 취소</option>
                                    <option value="RETURNED" th:selected="${param.orderStatus == 'RETURNED'}">반품</option>
                                    <option value="EXCHANGED" th:selected="${param.orderStatus == 'EXCHANGED'}">교환</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="searchType">검색어 유형</label>
                                <select class="form-select" id="searchType" name="searchType">
                                    <option value="orderNumber" th:selected="${param.searchType == 'orderNumber'}">주문번호</option>
                                    <option value="customerName" th:selected="${param.searchType == 'customerName'}">주문자명</option>
                                    <option value="customerPhone" th:selected="${param.searchType == 'customerPhone'}">연락처</option>
                                    <option value="productName" th:selected="${param.searchType == 'productName'}">상품명</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="searchKeyword">검색어</label>
                                <input type="text" class="form-input" id="searchKeyword" name="searchKeyword"
                                       th:value="${param.searchKeyword}" placeholder="검색어 입력">
                            </div>
                        </div>
                    </div>

                    <div class="search-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> 검색
                        </button>
                        <button type="button" id="resetBtn" class="btn btn-outline">
                            <i class="fas fa-redo"></i> 초기화
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h3>주문 목록</h3>
                <span class="order-count" th:text="'총 ' + ${orders.size()} + '건'">총 0건</span>
            </div>
            <div class="table-responsive">
                <table class="order-table">
                    <thead>
                    <tr>
                        <th>
                            <label class="checkbox-label">
                                <input type="checkbox" id="selectAllOrders">
                                <span class="checkmark"></span>
                            </label>
                        </th>
                        <th>주문번호</th>
                        <th>주문일시</th>
                        <th>주문자</th>
                        <th>상품정보</th>
                        <th>결제금액</th>
                        <th>상태</th>
                        <th>배송정보</th>
                        <th>관리</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${orders}">
                        <td colspan="9" class="no-data">주문 내역이 없습니다.</td>
                    </tr>
                    <tr th:each="order : ${orders}">
                        <td>
                            <label class="checkbox-label">
                                <input type="checkbox" class="order-checkbox" th:value="${order.id}">
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td th:text="${order.orderNumber}">20240516-123456</td>
                        <td th:text="${order.orderDateStr}">2024-05-16 14:30</td>

                        <td class="customer-info">
                            <div th:text="${order.customerName}">홍길동</div>
                            <div class="text-light" th:text="${order.customerPhone}">010-1234-5678</div>
                        </td>
                        <td class="product-info">
                            <div class="product-name" th:text="${order.mainProductName + (order.productCount > 1 ? ' 외 ' + (order.productCount - 1) + '건' : '')}">
                                나이키 에어맥스 90 외 2건
                            </div>
                            <div class="order-option text-light" th:text="${'사이즈: ' + order.mainProductSize}">사이즈: 260</div>
                        </td>
                        <td class="price-info">
                            <div th:text="${#numbers.formatInteger(order.totalAmount, 0, 'COMMA') + '원'}">89,000원</div>
                            <div class="payment-method text-light" th:text="${order.paymentMethod}">카드결제</div>
                        </td>
                        <td>
                <span class="status-badge" th:classappend="${'status-' + #strings.toLowerCase(order.status)}"
                      th:text="${order.statusName}">결제완료</span>
                        </td>
                        <td class="shipping-info">
                            <div th:text="${order.trackingCompany}">CJ대한통운</div>
                            <div th:if="${order.trackingNumber}" class="tracking-number">
                                <a href="#" target="_blank" th:href="${order.trackingLink}" th:text="${order.trackingNumber}">
                                    123456789012
                                </a>
                            </div>
                            <div th:unless="${order.trackingNumber}" class="text-light">미등록</div>
                        </td>
                        <td class="action-buttons">
                            <a th:href="@{'/admin/orders/' + ${order.id}}" class="btn btn-icon btn-outline">
                                <i class="fas fa-eye"></i>
                            </a>
                            <button th:if="${order.status == 'PAYMENT_COMPLETE'}"
                                    type="button" class="btn btn-icon btn-primary status-update-btn"
                                    th:data-id="${order.id}" data-action="preparing">
                                <i class="fas fa-box"></i>
                            </button>
                            <button th:if="${order.status == 'PREPARING'}"
                                    type="button" class="btn btn-icon btn-primary tracking-btn"
                                    th:data-id="${order.id}">
                                <i class="fas fa-truck"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="batch-actions">
                <button id="batchStatusBtn" class="btn btn-outline" disabled>
                    <i class="fas fa-tasks"></i> 일괄 상태 변경
                </button>
                <button id="batchPrintBtn" class="btn btn-outline" disabled>
                    <i class="fas fa-print"></i> 송장 일괄 출력
                </button>
            </div>

            <!-- 페이징 -->
            <!--/*<div class="pagination-container" >
                <ul class="pagination">
                    <li th:class="${orders.first ? 'disabled' : ''}">
                        <a th:if="${!orders.first}" th:href="@{${#httpServletRequest.requestURI}(
              page=0,
              size=${orders.size},
              orderDateStart=${param.orderDateStart},
              orderDateEnd=${param.orderDateEnd},
              orderStatus=${param.orderStatus},
              searchType=${param.searchType},
              searchKeyword=${param.searchKeyword}
            )}">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <span th:if="${orders.first}">
              <i class="fas fa-angle-double-left"></i>
            </span>
                    </li>

                    <li th:class="${orders.first ? 'disabled' : ''}">
                        <a th:if="${!orders.first}" th:href="@{${#httpServletRequest.requestURI}(
              page=${orders.number - 1},
              size=${orders.size},
              orderDateStart=${param.orderDateStart},
              orderDateEnd=${param.orderDateEnd},
              orderStatus=${param.orderStatus},
              searchType=${param.searchType},
              searchKeyword=${param.searchKeyword}
            )}">
                            <i class="fas fa-angle-left"></i>
                        </a>
                        <span th:if="${orders.first}">
              <i class="fas fa-angle-left"></i>
            </span>
                    </li>

                    <li th:each="i : ${#numbers.sequence(0, orders.totalPages - 1)}"
                        th:if="${i >= orders.number - 2 && i <= orders.number + 2}"
                        th:class="${i == orders.number ? 'active' : ''}">
                        <a th:href="@{${#httpServletRequest.requestURI}(
              page=${i},
              size=${orders.size},
              orderDateStart=${param.orderDateStart},
              orderDateEnd=${param.orderDateEnd},
              orderStatus=${param.orderStatus},
              searchType=${param.searchType},
              searchKeyword=${param.searchKeyword}
            )}" th:text="${i + 1}">1</a>
                    </li>

                    <li th:class="${orders.last ? 'disabled' : ''}">
                        <a th:if="${!orders.last}" th:href="@{${#httpServletRequest.requestURI}(
              page=${orders.number + 1},
              size=${orders.size},
              orderDateStart=${param.orderDateStart},
              orderDateEnd=${param.orderDateEnd},
              orderStatus=${param.orderStatus},
              searchType=${param.searchType},
              searchKeyword=${param.searchKeyword}
            )}">
                            <i class="fas fa-angle-right"></i>
                        </a>
                        <span th:if="${orders.last}">
              <i class="fas fa-angle-right"></i>
            </span>
                    </li>

                    <li th:class="${orders.last ? 'disabled' : ''}">
                        <a th:if="${!orders.last}" th:href="@{${#httpServletRequest.requestURI}(
              page=${orders.totalPages - 1},
              size=${orders.size},
              orderDateStart=${param.orderDateStart},
              orderDateEnd=${param.orderDateEnd},
              orderStatus=${param.orderStatus},
              searchType=${param.searchType},
              searchKeyword=${param.searchKeyword}
            )}">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                        <span th:if="${orders.last}">
              <i class="fas fa-angle-double-right"></i>
            </span>
                    </li>
                </ul>
            </div>
        </div>
    </div>*/-->

    <!-- 송장 번호 등록 모달 -->
    <div id="trackingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>송장 정보 등록</h4>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="trackingForm">
                    <input type="hidden" id="orderId" name="orderId">
                    <div class="form-group">
                        <label for="trackingCompany">택배사</label>
                        <select class="form-select" id="trackingCompany" name="trackingCompany" required>
                            <option value="">택배사 선택</option>
                            <option value="CJ대한통운">CJ대한통운</option>
                            <option value="롯데택배">롯데택배</option>
                            <option value="우체국택배">우체국택배</option>
                            <option value="한진택배">한진택배</option>
                            <option value="로젠택배">로젠택배</option>
                            <option value="편의점택배">편의점택배</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="trackingNumber">송장번호</label>
                        <input type="text" class="form-input" id="trackingNumber" name="trackingNumber"
                               placeholder="송장번호 입력" required>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">등록</button>
                        <button type="button" class="btn btn-cancel close-modal-btn">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 일괄 상태 변경 모달 -->
    <div id="batchStatusModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>주문 상태 일괄 변경</h4>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="batchStatusForm">
                    <div class="form-group">
                        <label for="batchOrderStatus">변경할 상태</label>
                        <select class="form-select" id="batchOrderStatus" name="status" required>
                            <option value="">상태 선택</option>
                            <option value="PREPARING">상품 준비중</option>
                            <option value="SHIPPING">배송중</option>
                            <option value="DELIVERED">배송 완료</option>
                            <option value="CANCELED">주문 취소</option>
                        </select>
                    </div>
                    <div class="selected-orders-info">
                        <p>선택된 주문: <span id="selectedOrderCount">0</span>건</p>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">변경</button>
                        <button type="button" class="btn btn-cancel close-modal-btn">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
        </div>
    </div>
</section>

<script th:src="@{/admin/js/orders-list.js}"></script>
</body>
</html>